import { Link } from '@brillout/docpress'
import { UiFrameworkExtension } from '../../components'
import { TableStyle } from './TableStyle'

You can use the following settings for adding `<head>` tags.

<TableStyle>
Setting | Sets
-- | --
`title` | <ul><li>`<title>`</li> <li>[`<meta property="og:title">`](https://ogp.me/#metadata:~:text=every%20page%20are%3A-,og%3Atitle,-%2D%20The%20title%20of)</li></ul>
`description` | <ul><li>`<meta name="description">`</li> <li>[`<meta property="og:description">`](https://ogp.me/#optional:~:text=accompany%20this%20object.-,og%3Adescription,-%2D%20A%20one%20to)</li></ul>
`viewport` | <ul><li>`<meta name="viewport">`</li></ul>
`Head` | Other `<head>` tags such as: <ul> <li>`<link rel="icon">` (favicon)</li> <li>`<link rel="apple-touch-icon">` (mobile icon)</li> <li>`<meta property="og:image">` (preview image)</li> <li>`<script>`</li> <li>...</li> </ul>
> You can also create <Link href="#custom-settings">custom settings</Link>.
</TableStyle>

- Low-level setting `Head` for setting other `<head>` tags (for example  or `<script>`).
- The `useConfig()` hook to dynamically set the above settings inside components (e.g. ) or Vike hooks (most notably the `+data` hook).

> See also `htmlAttributes` and `bodyAttributes` to add attributes such as `<html class="dark">` or `<body class="dark">`.

> These settings are provided by <UiFrameworkExtension name />, see <Link href="#without-vike-react-vue-solid" /> if you don't use such extension.

## Example

You can set some global default `<title>` and `<meta name="description">`:

For example:

```js
// pages/+config.js

export default {
  // Default <title>
  title: 'Awesome Rockets',
 // Default <meta name="description">
  description: 'We deliver payload to space'
}
```
```jsx
// /pages/+Head.jsx or
// /pages/+Head.vue
// Environment: server

export { Head }

import previewImage from './previewImage.jpg'

function Head() {
  return <>
    <meta property="og:image" content={previewImage}>
  </>
}
```

> This doesn't work:
> ```js
> // pages/about/+Head.jsx
>
> function Head() {
>   return <>
>     <title>About us</title> // [!code ++]
>   </>
> }
> ```
> ```js
> // pages/index/+Head.jsx
>
> function Head() {
>   return <>
>     <title>About us</title> // [!code ++]
>   </>
> }
> ```
> Because `<Head>` is rendered only for the first page the user navigates to: for subsequent
> rendered for the very first to HTML
> The problem is that, upon <Link href="/client-routing">client-side page navigation</Link>, the title of the page won't be updated.

```ts
// pages/product/+title.ts
// Environment: server, client
import type { PageContext } from 'vike/types'
export default (pageContext) => pageContext.data.rocket.name
```

```ts
// pages/product/+description.ts
// Environment: server, client
import type { PageContext } from 'vike/types'
export default (pageContext) => pageContext.data.rocket.description
```

> Alternatively, you can also use `useConfig()` to 


## `Head`

Setting `<head>` tags only to one page and based on <Link href="/data-fetching">fetched data</Link>:

```js
// /pages/rocket/starship/+data.js
// Environment: server

export { data }

async function data() {
  const rocket = await sql.run(
    'SELECT { title, description, social_image } FROM rockets WHERE name = "starship";'
  )
  return rocket
}
```
```jsx
// /pages/rocket/starship/+Head.jsx
// Environment: server

export { Head }

import { useData } from 'vike-react/useData' // or vike-vue / vike-solid

function Head() {
  const rocket = useData()
  return <>
    <meta name="description" content={rocket.description}>
    <meta property="og:image" content={rocket.social_image}>
  </>
}
```


## `title` & `favicon`

If your pages can have different `<title>` values, then use the setting `title` instead of the <Link href="#head">`Head`</Link> setting:

```js
// /pages/rocket/starship/+title.js
// Environment: server, client
export const title = 'SpaceX | Rocket Starship'
```
```js
// /pages/rocket/falcon-9/+title.js
// Environment: server, client
export const title = 'SpaceX | Rocket Falcon 9'
```

Upon <Link href="/client-routing">client-side navigating</Link> from the URL `/rocket/starship` to `/rocket/falcon-9`, the page's title is dynamically updated from `SpaceX | Rocket Starship` to `SpaceX | Rocket Falcon 9`. (By mutating the DOM with [`document.title = 'SpaceX | Rocket Falcon 9'`](https://developer.mozilla.org/en-US/docs/Web/API/Document/title).)

While defining `<title>` by using the `Head` setting correctly sets the page's title for the first page the user visits, it doesn't update the page's title upon <Link href="/client-routing">client-side navigation</Link>.

> Most `<head>` tags, such as [the social image tag `<meta property="og:image">`](https://ogp.me/), don't need to be updated upon client-side navigation because they are only used by crawlers. (Browsers don't do anything with `<meta property="og:image">`.) Crawlers don't execute JavaScript and, therefore, don't client-side navigate.

Likewise, if your [favicon](https://developer.mozilla.org/en-US/docs/Learn/HTML/Introduction_to_HTML/The_head_metadata_in_HTML#adding_custom_icons_to_your_site) can change from page to page, then define `/pages/rocket/starship/+favicon.png` instead of using the `Head` setting.

You can set `title` and `favicon` based on <Link href="/data-fetching">fetched data</Link>, for example:

```js
// /pages/rocket/starship/+title.js
// Environment: server, client

export function title(pageContext) {
  const rocket = pageContext.data
  return rocket.title
}
```
```tsx
// With TypeScript:

import type { Data } from './+data'
import type { PageContext } from 'vike/types'
export function title(pageContext: PageContext<Data>) {
  const rocket = pageContext.data
  return rocket.title
}
```
> As shown [here](https://gist.github.com/brillout/e7fe603bd44c9ec1be7e98f3ae28636a) you can define the logic, of using `data.title` to set the page's title, once and apply it to all your pages.


## `useHead()`

The upcoming `useHead()` component hook will enable any UI component to add `<head>` tags, see: [New component hook `useHead()`](https://github.com/vikejs/vike-react/issues/67).

## Custom settings

TODO


## Internationalization

Example of internationalizing (i18n) `<head>` tags:

```jsx
// /pages/+Head.js
// Environment: server

export { Head }

import { usePageContext } from 'vike-react/usePageContext' // or 'vike-vue' / 'vike-solid'

function Head() {
  const pageContext = usePageContext()
  const description = pageContext.locale === 'de-DE' ?
    'Wir liefern zum Weltall.' :
    'We deliver payload to space.'
  return <>
    <meta name="description" content={description}>
  </>
}
```
```js
// /pages/+title.js
// Environment: server, client

export function title(pageContext) {
  const title = pageContext.locale === 'de-DE' ?
    'SpaceX | Das Weltall Unternehmen' :
    'SpaceX | The space company'
  return title
}
```

See also:
 - <Link href="/i18n" />
 - <Link href="/usePageContext" />


## Without `vike-{react,vue,solid}`

If you don't use a Vike extension, then you have direct control over `<head>` tags in your <Link href="/onRenderHtml">`onRenderHtml()` hook</Link>.

```js
// /renderer/+onRenderHtml.js
// Environment: server

import { escapeInject, dangerouslySkipEscape } from 'vike/server'
import { renderToHtml } from 'some-ui-framework'

export { onRenderHtml }

async function onRenderHtml(pageContext) {
  return escapeInject`<html>
    <head>
      <title>SpaceX</title>
      <meta name="description" content="We deliver payload to space.">
    </head>
    <body>
      <div id="root">
        ${dangerouslySkipEscape(await renderToHtml(pageContext.Page))}
      </div>
    </body>
  </html>`
}
```


### By page

To define `<head>` tags on page-by-page basis, we recommend creating new settings, for example `title` and `description` as shown at <Link href="/meta#example-title-and-description" doNotInferSectionTitle />.


### By component

To define `<head>` tags by any UI component:
 1. Add `'headProps'` to [`passToClient`](/passToClient).
 2. Use <Link href="/usePageContext">`usePageContext()`</Link> so that `pageContext.headProps` can be accessed and modified by any component.

For example:

```js
// /renderer/+onRenderHtml.js
// Environment: server

export { onRenderHtml }

import { escapeInject, dangerouslySkipEscape } from 'vike/server'
import renderToHtml from 'some-ui-framework'

async function onRenderHtml(pageContext) {
  // We use our UI framework to pass `pageContext.headProps` to all components
  // of our component tree. (E.g. React Context or Vue's `app.config.globalProperties`.)
  const pageHtml = await renderToHtml(
    <ContextProvider headProps={pageContext.headProps} >
      <Page />
    </ContextProvider>
  )

  // 1. One of our UI component modified pageContext.headProps while rendering components.
  // 2. We now render `headProps` to HTML meta tags.
  return escapeInject`<html>
    <head>
      <title>${pageContext.headProps.title}</title>
      <meta name="description" content="${pageContext.headProps.description}">
    </head>
    <body>
      <div id="app">
        ${dangerouslySkipEscape(pageHtml)}
      </div>
    </body>
  </html>`
}
```

```js
// SomeComponent.js

  // Inside a UI component
  const pageContext = usePageContext()
  const { headProps } = pageContext
  headProps.title = 'I was set by some component.'
  headProps.description = 'Me too.'
```


### Client Routing

If you use Client Routing, make sure to update `document.title` upon page navigation:

```js
// /renderer/+config.js
// Environment: config

export default {
  // Make pageContext.headProps available on the client-side.
  passToClient: ['headProps']
}
```

```js
// /renderer/+onRenderClient.js
// Environment: client

export { onRenderClient }

async function onRenderClient(pageContext) {
  if (!pageContext.isHydration) {
    // Client-side navigation â€” we update the page's title
    document.title = pageContext.headProps.title
  }
  // ...
}
```


### Libraries

You can also use libraries such as [@vueuse/head](https://github.com/vueuse/head) or [react-helmet](https://github.com/nfl/react-helmet).

But we recommend using such library only if you have a rationale as the aforementioned solutions are simpler.

Head libraries already sanitize the HTML `<head>`, this means you can skip `escapeInject` and wrap the overall result with `dangerouslySkipEscape()`.

```js
// /renderer/+onRenderHtml.js
// Environment: server

export { onRenderHtml }

import { dangerouslySkipEscape } from 'vike/server'
import { renderToHtml } from 'some-ui-framework'

async function onRenderHtml(pageContext) {
  return dangerouslySkipEscape(await renderToHtml(pageContext.Page))
}
```

## See also

- <Link href="/Head" />
- <Link href="/markdown#metadata" />
- <Link href="/data-fetching" />
- <Link href="/lang" />
- <Link href="/usePageContext" />
- <Link href="/useData" />
- <Link href="/pageContext" />
- [Blog post "My current HTML boilerplate" showcasing and explaing a common boilerplate](https://www.matuzo.at/blog/html-boilerplate/)
